services:
  nrtm4serve:
    image: docker.io/etchells/nrtm4serve:latest
    ports:
      - "8000:8080"
    environment:
      - PG_DATABASE_URL=postgres://nrtm4:nrtm4@localhost:15432/nrtm4?sslmode=disable
      - NRTM4_FILE_PATH=/tmp
    depends_on:
      - postgresql
    healthcheck:
      test: [ "CMD-SHELL", "curl --silent --fail http://localhost:8000/index.html || exit 1" ]
      interval: 10s
      timeout: 10s
      retries: 3
    networks:
      - db
  postgresql:
    image: docker.io/library/postgres:16
    user: postgres
    # expose:
    #   - 5432
    environment:
      - POSTGRES_HOST_AUTH_METHOD=trust
    volumes:
      - ./nrtm4_schema.sql:/docker-entrypoint-initdb.d/nrtm4_schema.sql
    healthcheck:
      test: [ "CMD", "pg_isready" ]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - db
    ports:
      - "15432:5432"

networks:
  db:


